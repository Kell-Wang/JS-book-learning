<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>8.4 自定义事件</title>
</head>
<body>
    <script>
        /** 至此，8.4 自定义事件--1.html 我们已经实现了一个最简单的发布-订阅模式，但这里还存在一些问题。
         * 我们看到订阅者接收到了发布者发布的每个消息，虽然小明只想买 88 平方米的房子，但是发布者把 110
         * 平方米的信息页推送给了小明，这对小明来说 是不必要的困扰。所以我们有必要添加一个表示 key,
         * 让订阅者之订阅自己感兴趣的消息。  */

        // 定义售楼处
        let salesOffices = {};
        // 缓存列表，存放订阅者的回调函数
        salesOffices.clientList = [];
        // 增加订阅者
        salesOffices.listen = function(fn) {
            // 订阅的消息添加进缓存列表
            this.clientList.push(fn);
        };
        // 发布消息
        salesOffices.trigger = function() {
            for (var i = 0, fn; fn= this.clientList[i++]; ) {
                // arguments 是发布消息时带上的参数
                fn.apply(this, arguments);
            }
        };

        // 下面我们来做一些简单的测试
        salesOffices.listen(function(price, squareMeter) {
            console.log("价格= " + price);
            console.log(squareMeter + "平方米");
        });
        salesOffices.listen(function(price, squareMeter){
            console.log("价格= " + price);
            console.log(squareMeter + "平方米");
        });

        // 注: trigger() 调用一次上面 listen() 方法就会执行2次，所以输出结果为: 2 次 (价格= 2000000  88平方米 )
        salesOffices.trigger(2000000, 88);

        // 输出结果: 2 次 (价格= 3000000  110平方米 )
        salesOffices.trigger(3000000, 110);
    </script>
</body>
</html>
