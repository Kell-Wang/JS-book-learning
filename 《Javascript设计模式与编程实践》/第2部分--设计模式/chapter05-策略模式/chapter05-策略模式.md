# 第 5 章 -- 策略模式

## 本章目录 (Catalog)
- 5.1 使用策略模式计算奖金 
- 5.2 JavaScript 版本的策略模式
- 5.3 多态的策略模式中的体现
- 5.4 使用策略模式实现缓动动画
    + 5.4.1 实现动画效果的原理
    + 5.4.2 思路和一些准备工作
    + 5.4.3 让小球运动起来
- 5.5 更广义的 "算法"
- 5.6 表单校验
    + 5.6.1 表单校验的第一个版本
    + 5.6.2 用策略模式重构表单校验
    + 5.6.3 给某个文本输入框添加多种校验规则
- 5.7 策略模式的优缺点
- 5.8 一等函数对象与策略模式
- 5.9 小结


## 生词 (New Words)
- **performance [pɚ'fɔrməns] --n.性能, 表现, 表演, 履行**
    + calculated performance. 计算性能.
    + performance appraisal. 绩效评估
- **appraisal [ə'prezl] --n.评价, 鉴定, 估价**
    + performance appraisal. 业绩评价, 成绩评价
    + project appraisal. 项目评估
    + appraisal report. 评估报告
    + appraisal theory. 评价理论
- **strategy ['strætɪdʒɪ] --n.战略，策略**
    + option merge strategies  选项合并策略
- **bonus ['bonəs] --n.奖金; 红利**
    + annual bonus. 年终分红
    + year-end bonus. 年终奖金
    + bonus tax. n.奖金税
- **spherule ['sfɪərjʊl] --n.小球(体)**

## 本章内容 (Content)
- 策略模式的定义是: 定义一系列的算法, 把它们一个个封装起来, 并且使它们可以相互替换.

### 5.1 使用策略模式计算奖金 
- (1) 最初的代码实现
- (2) 使用组合函数重构代码
- (3) 使用策略模式重构代码
    + 策略模式指的是定义一系列的算法, 把他们一个一个封装起来. 
      `将不变的部分和变化的部分隔开是每个**设计模式**的主题`, 策略模式也不例外, 
      `策略模式的目的就是将算法的使用和算法的实现分离开来`.
    + 一个基于策略模式的程序至少由 2 部分组成.
        - 第 1 个部分是`一组策略类`, 策略类封装了具体的算法, 并负责具体的计算过程.
        - 第 2 个部分是`环境类 Context (上下文)`, Context 接受客户的请求, 随后把
          请求委托给某一个策略类. 要做到这点, 说明 Context 中要维持对某个策略对象的引用.
    + 现在用策略模式来重构上面的代码。第一个版本是模仿传统面向对象语言中的实现。我们先把
      每种绩效的计算规则都封装在对应的策略类里面：

### 5.2 JavaScript 版本的策略模式
- 见文件 `5.2-JavaScript版本的策略模式.html`.

### 5.3 多态的策略模式中的体现
- 通过使用策略模式重构代码，我们消除了原程序中大片的条件分支语句。所有跟计算奖金有关的
  逻辑不再放在 Context 中，而是分布在各个策略对象中 [见:
  `5.2-JavaScript版本的策略模式.html` 中的代码]。Context并没有计算奖金的能力，
  而是把这个职责委托给了某个策略对象。每个策略对象负责的算法已被各自封装在对象内部。
  当我们对这些策略对象发出 "计算奖金" 的请求时，它们会返回各自不同的计算结果，这正是
  对象多态性的体现，也是 "它们可以相互替换" 的目的。替换 Context 中当前保存的策略对象,
  便能执行不同的算法来得到我们想要的结果.

### 5.4 使用策略模式实现缓动动画
- 5.4.1 实现动画效果的原理
    + 在 JavaScript中，可以通过连续改变元素的某个 CSS属性，比如 left、top、
      background-position 来实现动画效果。
- 5.4.2 思路和一些准备工作
    + 我们目标是编写一个动画类和一些缓动算法，让小球以各种各样的缓动效果在页面中运动。
      现在来分析实现这个程序的思路。在运动开始之前，需要提前记录一些有用的信息，至少包
      括以下信息：
        - 动画开始时，小球所在的原始位置；
        - 小球移动的目标位置；
        - 动画开始时的准确时间点；
        - 小球运动持续的时间。
    + 随后，我们会用 setInterval 创建一个定时器，定时器每隔 19ms 循环一次。
      在定时器的每一帧里，我们会把动画已消耗的时间、小球原始位置、小球目标位置和动画持续的
      总时间等信息传入缓动算法。该算法会通过这几个参数，计算出小球当前应该所在的位置。最后
      再更新该 div 对应的 CSS 属性，小球就能够顺利地运动起来了。
- 5.4.3 让小球运动起来

### 5.5 更广义的 "算法"

### 5.6 表单校验
- 5.6.1 表单校验的第一个版本
- 5.6.2 用策略模式重构表单校验
- 5.6.3 给某个文本输入框添加多种校验规则

### 5.7 策略模式的优缺点

### 5.8 一等函数对象与策略模式

### 5.9 小结
